# wasm plugin PoC

## prerequisites
- _cargo install wasm-pack_

## project layout
- /app
  - directory to contain statically served assets
  - collects all js and wasm artifacts produced
  - contains a html to serve a bootstrap for js/wasm code
- /webserver
  - simple http server to server _/app_
- /webapp
  - _main_ wasm app
  - loads and initialises _plugin_ code during runtime
- /plugin
  - dynamically loaded wasm code

## build
- execute `./build.sh` to let wasm-bindgen and wasm-pack do it's magic
- let the webserver serve the _/app_ directory with `./serve.sh`

## challenges
- accessing the _start_ function in _plugin_ from the instantiated wasm module
  - thankfully _js_sys::Reflect_ exists to just dynamically search through js objects
- to work properly _plugin_ needs some function imports (for use of _wasm-logger_)
  - solution attempt: forward _main's_ imports to _plugin_ as they are essentially the same
  - this is achieved by modifying _main.js_, generated by wasm-bindgen

## conclusion 
This PoC does not work, and probably will not work as intended in the near future.
- the way _js_ and _wasm_ interact, it does not seem possible to throw a rust object from one wasm module to another
- both _main_ and _plugin_ wasm code is compiled and statically linked with all dependencies
  - _plugin_ does not need all dependencies, since _main_ would already provide a great many
  - _plugin_ seems to have no access to _main's_ code and shared dependencies
  - IMHO this can only really be solved by dynamically linking wasm-modules which is still some time away: https://github.com/rustwasm/wasm-bindgen/issues/2137

## disclaimer
- handling of a wasm blob inside rust is from: https://rustwasm.github.io/wasm-bindgen/examples/wasm-in-wasm.html
 
